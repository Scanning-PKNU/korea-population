<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>인구 데이터 시각화</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
  <h1>한국 인구 데이터 시각화</h1>

  <h2>파이 차트 (예: 지역별 인구 비율)</h2>
  <canvas id="pieChart" width="400" height="400"></canvas>

  <h2>선 그래프 (예: 연도별 인구 변화)</h2>
  <canvas id="lineChart" width="800" height="400"></canvas>

  <script>
    //실제 raw CSV URL. 테스트 때마다 수정 필요
    const csvUrl = "https://raw.githubusercontent.com/Scanning-PKNU/korea-population/main/data/hawsun_person_data.csv";

    fetch(csvUrl)
      .then(response => {
        if (!response.ok) {
          throw new Error("CSV 파일을 가져오는 데 실패했습니다: " + response.status);
        }
        return response.text();
      })
      .then(csvText => {
        Papa.parse(csvText, {
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            const rows = results.data;
            console.log(rows);

            // 필드명은 CSV 실제 컬럼명으로
            const labelFieldForPie = "법정동명";
            const valueFieldForPie = "총인원수";

            const labelFieldForLine = "연도";
            const valueFieldForLine = "총인원수";
            
            // 파이차트 데이터 구성
            const pieLabels = rows.map(r => r[labelFieldForPie]);
            const pieValues = rows.map(r => Number(r[valueFieldForPie]));

            new Chart(document.getElementById("pieChart"), {
              type: "pie",
              data: {
                labels: pieLabels,
                datasets: [{
                  data: pieValues,
                  backgroundColor: pieLabels.map((_, idx) => `hsl(${idx * 360 / pieLabels.length}, 70%, 50%)`)
                }]
              },
              options: {
                responsive: true,
                plugins: {
                  legend: {
                    position: 'right'
                  }
                }
              }
            });

            // 선그래프 데이터 구성
            const lineLabels = rows.map(r => r[labelFieldForLine]);
            const lineValues = rows.map(r => Number(r[valueFieldForLine]));

            new Chart(document.getElementById("lineChart"), {
              type: "line",
              data: {
                labels: lineLabels,
                datasets: [{
                  label: valueFieldForLine,
                  data: lineValues,
                  borderColor: 'blue',
                  fill: false
                }]
              },
              options: {
                responsive: true,
                scales: {
                  x: {
                    title: {
                      display: true,
                      text: labelFieldForLine
                    }
                  },
                  y: {
                    title: {
                      display: true,
                      text: valueFieldForLine
                    }
                  }
                }
              }
            });

          },
          error: function(err) {
            console.error("CSV 파싱 중 오류 발생:", err);
          }
        });
      })
      .catch(err => {
        console.error("Fetch 에러:", err);
      });

  </script>
</body>
</html>